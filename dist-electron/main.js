"use strict";const f=require("electron"),d=require("path"),c=require("fs"),Y=require("os"),V=require("child_process"),G=require("util"),M=require("crypto"),j=require("node:crypto"),Q=require("tar"),ee=["C:\\Program Files (x86)\\Steam","C:\\Program Files\\Steam",d.join(Y.homedir(),"Steam"),"D:\\Steam","E:\\Steam","D:\\SteamLibrary","E:\\SteamLibrary"];function O(){for(const e of ee)if(c.existsSync(d.join(e,"steamapps","libraryfolders.vdf")))return e;return null}function R(e){const n={},t=e.split(`
`),s=[n];let r="";for(const i of t){const o=i.trim();if(!o||o.startsWith("//"))continue;if(o==="{"){const u={};s[s.length-1][r]=u,s.push(u);continue}if(o==="}"){s.pop();continue}const a=o.match(/^"([^"]+)"\s*"([^"]*)"$/);if(a){const[,u,h]=a;s[s.length-1][u]=h;continue}const l=o.match(/^"([^"]+)"$/);l&&(r=l[1])}return n}function ne(e){const n=d.join(e,"steamapps","libraryfolders.vdf");if(!c.existsSync(n))return[e];try{const t=c.readFileSync(n,"utf-8"),r=R(t).libraryfolders;if(!r)return[e];const i=[];for(const o of Object.keys(r))if(/^\d+$/.test(o)){const a=r[o];a&&typeof a.path=="string"&&i.push(a.path)}return i.length>0?i:[e]}catch(t){return console.error("Failed to parse libraryfolders.vdf:",t),[e]}}function te(e){try{const n=c.readFileSync(e,"utf-8"),s=R(n).AppState;if(!s)return null;const r=s.appid,i=s.name,o=s.installdir;if(!r||!i||!o)return null;const a=d.dirname(d.dirname(e)),l=d.join(a,"steamapps","common",o);return{appId:r,name:i,installDir:o,fullPath:l}}catch(n){return console.error(`Failed to parse manifest ${e}:`,n),null}}function se(e){const n=d.join(e,"steamapps");if(!c.existsSync(n))return[];const t=[];try{const s=c.readdirSync(n);for(const r of s)if(r.startsWith("appmanifest_")&&r.endsWith(".acf")){const i=d.join(n,r),o=te(i);o&&c.existsSync(o.fullPath)&&t.push(o)}}catch(s){console.error(`Failed to scan library ${e}:`,s)}return t}function re(){const e=O();if(!e)return console.warn("Steam installation not found"),[];const n=ne(e),t=[];for(const s of n){const r=se(s);t.push({path:s,apps:r})}return t}function ae(){return re().flatMap(n=>n.apps)}function ie(e){const n=[e],t=["LEGO","LOTR","GTA","COD","NFS","NBA","NFL","WWE","DMC","MGS","AOE","CIV"];if(e===e.toUpperCase()&&e.length>4){let a=e;for(const l of t)e.includes(l)&&e!==l&&(a=a.replace(new RegExp(`(${l})`,"g")," $1 ").trim().replace(/\s+/g," "));a!==e&&n.push(a)}const s=e.replace(/([a-z])([A-Z])/g,"$1 $2").replace(/([A-Z]+)([A-Z][a-z])/g,"$1 $2");s!==e&&n.push(s);const r={LOTR:"Lord of the Rings",LEGO:"LEGO",GTA:"Grand Theft Auto",COD:"Call of Duty",NFS:"Need for Speed",FIFA:"FIFA",NBA:"NBA",NFL:"NFL",WWE:"WWE",RE:"Resident Evil",DMC:"Devil May Cry",MGS:"Metal Gear Solid",FF:"Final Fantasy",KH:"Kingdom Hearts",AC:"Assassins Creed",FC:"Far Cry",BF:"Battlefield",TW:"Total War",AOE:"Age of Empires",CIV:"Civilization",WOW:"World of Warcraft",DOTA:"Dota",LOL:"League of Legends",CS:"Counter Strike",TF:"Team Fortress",HL:"Half Life",L4D:"Left 4 Dead"},i=Array.from(new Set([e,...n.slice(1)]));for(const a of i){let l=a;for(const[u,h]of Object.entries(r))new RegExp(`\\b${u}\\b`,"gi").test(l)&&(l=l.replace(new RegExp(`\\b${u}\\b`,"gi"),h));l!==a&&!n.includes(l)&&n.push(l)}const o=e.replace(/^(The|A)\s+/i,"").replace(/\s*(Game|Edition|Remastered|Remake|HD|Definitive|GOTY)$/i,"");return o!==e&&o.length>2&&n.push(o),Array.from(new Set(n))}async function oe(e){if(!e||e.length<2)return null;const n=ie(e);for(const t of n)try{const s=`https://store.steampowered.com/api/storesearch/?term=${encodeURIComponent(t)}&l=english&cc=US`,r=await fetch(s,{headers:{"User-Agent":"DXVK-Studio"}});if(!r.ok)continue;const i=await r.json();if(i.items&&i.items.length>0)return console.log(`Steam search: "${e}" â†’ "${t}" found: ${i.items[0].name}`),i.items[0].id}catch(s){console.warn(`Failed to search Steam Store for "${t}":`,s)}return null}async function ce(e){if(!e||e.length<2)return[];try{const n=`https://store.steampowered.com/api/storesearch/?term=${encodeURIComponent(e)}&l=english&cc=US`,t=await fetch(n,{headers:{"User-Agent":"DXVK-Studio"}});if(!t.ok)return[];const s=await t.json();return s.items?s.items.slice(0,10).map(r=>({id:r.id,name:r.name,imageUrl:`https://steamcdn-a.akamaihd.net/steam/apps/${r.id}/header.jpg`})):[]}catch(n){return console.warn(`Failed to search Steam Store for "${e}":`,n),[]}}const $=G.promisify(V.exec),le="HKLM\\SOFTWARE\\WOW6432Node\\GOG.com\\Games";async function ue(){var n;const e=[];try{const{stdout:t}=await $(`reg query "${le}"`),r=t.split(`
`).filter(i=>i.trim().length>0).filter(i=>i.includes("GOG.com\\Games\\"));for(const i of r)try{const o=(n=i.split("\\").pop())==null?void 0:n.trim();if(!o)continue;const{stdout:a}=await $(`reg query "${i.trim()}" /s`),l=a.match(/\s+path\s+REG_SZ\s+(.+)/i),u=a.match(/\s+exe\s+REG_SZ\s+(.+)/i),h=a.match(/\s+gameName\s+REG_SZ\s+(.+)/i)||a.match(/\s+displayName\s+REG_SZ\s+(.+)/i);if(l&&u){const m=l[1].trim(),g=d.join(m,u[1].trim()),x=h?h[1].trim():`GOG Game ${o}`;c.existsSync(g)&&e.push({id:`gog-${M.randomUUID()}`,name:x,path:m,executable:g,platform:"gog",dxvkStatus:"inactive",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),architecture:"unknown"})}}catch(o){console.warn(`Failed to parse GOG game key ${i}:`,o)}}catch(t){t.code!==1&&console.error("Error scanning GOG registry:",t)}return e}const p=[];for(let e=0;e<256;++e)p.push((e+256).toString(16).slice(1));function de(e,n=0){return(p[e[n+0]]+p[e[n+1]]+p[e[n+2]]+p[e[n+3]]+"-"+p[e[n+4]]+p[e[n+5]]+"-"+p[e[n+6]]+p[e[n+7]]+"-"+p[e[n+8]]+p[e[n+9]]+"-"+p[e[n+10]]+p[e[n+11]]+p[e[n+12]]+p[e[n+13]]+p[e[n+14]]+p[e[n+15]]).toLowerCase()}const D=new Uint8Array(256);let w=D.length;function fe(){return w>D.length-16&&(j.randomFillSync(D),w=0),D.slice(w,w+=16)}const P={randomUUID:j.randomUUID};function he(e,n,t){var r;e=e||{};const s=e.random??((r=e.rng)==null?void 0:r.call(e))??fe();if(s.length<16)throw new Error("Random bytes length must be >= 16");return s[6]=s[6]&15|64,s[8]=s[8]&63|128,de(s)}function pe(e,n,t){return P.randomUUID&&!e?P.randomUUID():he(e)}function me(){const e=[],n=process.env.ProgramData||"C:\\ProgramData",t=d.join(n,"Epic","EpicGamesLauncher","Data","Manifests");if(!c.existsSync(t))return[];try{const s=c.readdirSync(t);for(const r of s)if(r.endsWith(".item"))try{const i=c.readFileSync(d.join(t,r),"utf-8"),o=JSON.parse(i),{DisplayName:a,InstallLocation:l,LaunchExecutable:u}=o;if(a&&l&&u){const h=l,m=d.join(h,u);c.existsSync(m)&&e.push({id:`epic-${pe()}`,name:a,path:h,executable:m,platform:"epic",dxvkStatus:"inactive",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),architecture:"unknown"})}}catch(i){console.warn(`Failed to parse Epic manifest ${r}:`,i)}}catch(s){console.error("Failed to scan Epic manifests:",s)}return e}const ye=332,ge=34404,xe=[{name:"EasyAntiCheat",files:["EasyAntiCheat.exe","EasyAntiCheat_x64.dll","EasyAntiCheat_x86.dll"],riskLevel:"high",description:"Kernel-level anti-cheat. DXVK may trigger a ban."},{name:"BattlEye",files:["BEService.exe","BEClient_x64.dll","BEClient.dll"],riskLevel:"high",description:"Kernel-level anti-cheat. DXVK may trigger a ban."},{name:"Vanguard",files:["vgc.exe","vgk.sys"],riskLevel:"high",description:"Riot Vanguard. Do not use DXVK with Valorant."},{name:"PunkBuster",files:["pbsvc.exe","PnkBstrA.exe","PnkBstrB.exe"],riskLevel:"medium",description:"Legacy anti-cheat. May or may not detect DXVK."}];function k(e,n,t){const s=Buffer.alloc(t);return c.readSync(e,s,0,t,n),s}function T(e){let n=null;try{if(n=c.openSync(e,"r"),k(n,0,2).toString("ascii")!=="MZ")return{architecture:"unknown",machineType:0,isValid:!1,error:"Not a valid PE file (missing MZ signature)"};const r=k(n,60,4).readUInt32LE(0);if(r<64||r>1024)return{architecture:"unknown",machineType:0,isValid:!1,error:"Invalid PE header offset"};if(k(n,r,4).toString("ascii")!=="PE\0\0")return{architecture:"unknown",machineType:0,isValid:!1,error:"Invalid PE signature"};const a=k(n,r+4,2).readUInt16LE(0);let l="unknown";return a===ye?l="32":a===ge&&(l="64"),{architecture:l,machineType:a,isValid:!0}}catch(t){return{architecture:"unknown",machineType:0,isValid:!1,error:t instanceof Error?t.message:"Unknown error reading file"}}finally{n!==null&&c.closeSync(n)}}function N(e){const{readdirSync:n,statSync:t}=require("fs"),{join:s,extname:r}=require("path"),i=[];try{const o=n(e);for(const a of o){const l=s(e,a);try{if(t(l).isFile()&&r(a).toLowerCase()===".exe"){const h=a.toLowerCase();(!h.includes("unins")&&!h.includes("redist")&&!h.includes("vcredist")&&!h.includes("dxsetup")&&!h.includes("directx")&&!h.includes("crash")&&!h.includes("report")&&!h.includes("launcher")||h==="launcher.exe")&&i.push(a)}}catch{}}}catch(o){console.error(`Failed to scan directory ${e}:`,o)}return i}const Se=G.promisify(V.exec);async function ve(e){try{const t=`powershell -NoProfile -Command "(Get-Item '${e.replace(/'/g,"''")}').VersionInfo | Select-Object ProductName, FileDescription, OriginalFilename | ConvertTo-Json"`,{stdout:s}=await Se(t);return s.trim()?JSON.parse(s):{}}catch{return{}}}const U={official:"doitsujin/dxvk",gplasync:"Sporif/dxvk-async",nvapi:"jp7677/dxvk-nvapi"};function _(){var t,s;const e=((s=(t=f.app)==null?void 0:t.getPath)==null?void 0:s.call(t,"userData"))??d.join(process.env.APPDATA||"","dxvk-studio"),n=d.join(e,"engines");return c.existsSync(n)||c.mkdirSync(n,{recursive:!0}),n}function v(e,n){return d.join(_(),e,n)}function F(e,n){const t=v(e,n);return c.existsSync(d.join(t,"x64","dxgi.dll"))||c.existsSync(d.join(t,"x32","d3d9.dll"))}function W(e){const n=d.join(_(),e);if(!c.existsSync(n))return[];try{return c.readdirSync(n,{withFileTypes:!0}).filter(t=>t.isDirectory()).map(t=>t.name)}catch{return[]}}function H(e){let n=0;try{const t=c.readdirSync(e,{withFileTypes:!0});for(const s of t){const r=d.join(e,s.name);if(s.isFile()){const{statSync:i}=require("fs");n+=i(r).size}else s.isDirectory()&&(n+=H(r))}}catch{}return n}function be(){const e=[],n=["official","gplasync","nvapi"];for(const t of n){const s=W(t);for(const r of s){const i=v(t,r),o=H(i);e.push({fork:t,version:r,path:i,sizeBytes:o})}}return e}async function we(e,n=10){return e==="gplasync"?De(n):ke(e,n)}async function ke(e,n){const s=`https://api.github.com/repos/${U[e]}/releases?per_page=${n}`;try{const r=await fetch(s,{headers:{Accept:"application/vnd.github.v3+json","User-Agent":"DXVK-Studio"}});if(r.status===403)return console.warn("GitHub API rate limited - using fallback versions"),E(e);if(!r.ok)throw new Error(`GitHub API returned ${r.status}`);return await r.json()}catch(r){return console.error(`Failed to fetch releases for ${e}:`,r),E(e)}}async function De(e){const n=`https://gitlab.com/api/v4/projects/Ph42oN%2Fdxvk-gplasync/releases?per_page=${e}`;try{const t=await fetch(n,{headers:{"User-Agent":"DXVK-Studio"}});if(!t.ok)throw new Error(`GitLab API returned ${t.status}`);return(await t.json()).map(r=>{const i=r.assets.links.find(o=>o.name.endsWith(".tar.gz"));return{tag_name:r.tag_name,name:r.name,published_at:r.released_at,body:r.description,assets:i?[{name:i.name,browser_download_url:i.direct_asset_url}]:[]}})}catch(t){return console.error("Failed to fetch releases from GitLab:",t),E("gplasync")}}function E(e){if(e==="gplasync")return["2.7.1-1","2.7-1","2.6.2-1","2.6.1-1","2.6-1","2.5.3-1"].map(i=>({tag_name:`v${i}`,name:`DXVK GPL Async ${i}`,published_at:new Date().toISOString(),body:"Fallback version (API unavailable)",assets:[{name:`dxvk-gplasync-v${i}.tar.gz`,browser_download_url:`https://gitlab.com/Ph42oN/dxvk-gplasync/-/raw/main/releases/dxvk-gplasync-v${i}.tar.gz?ref_type=heads`}]}));const n={official:{versions:["2.7.1","2.7","2.6.1","2.5.3","2.5.1","2.5","2.4.1"],assetPrefix:"dxvk"},nvapi:{versions:["0.7.1","0.7.0","0.6.9","0.6.8","0.6.7"],assetPrefix:"dxvk-nvapi"}},t=U[e],s=n[e];return s.versions.map(r=>{const i=e==="nvapi"?`v${r}`:r,o=`${s.assetPrefix}-${i}.tar.gz`;return{tag_name:`v${r}`,name:`DXVK ${r}`,published_at:new Date().toISOString(),body:"Fallback version (API rate limited)",assets:[{name:o,browser_download_url:`https://github.com/${t}/releases/download/v${r}/${o}`}]}})}function Ee(e,n){const t=e.assets.find(r=>r.name.endsWith(".zip")||r.name.endsWith(".tar.gz")||r.name.endsWith(".tar.xz"));if(!t)return console.warn(`No downloadable asset found for release ${e.tag_name}`),null;const s=e.tag_name.replace(/^v/,"");return{id:`${n}-${s}`,version:s,fork:n,releaseDate:e.published_at,downloadUrl:t.browser_download_url,localPath:v(n,s),cached:F(n,s),changelog:e.body}}async function _e(e){const t=(await we(e)).map(s=>Ee(s,e)).filter(s=>s!==null);for(const s of t)s.cached=F(e,s.version),s.cached&&(s.localPath=v(e,s.version));return t}async function Fe(e,n,t,s){var o;const r=v(e,n),i=d.join(_(),`temp-${e}-${n}.tar.gz`);c.mkdirSync(r,{recursive:!0});try{const a=await fetch(t);if(!a.ok)throw new Error(`Download failed: ${a.status}`);const l=parseInt(a.headers.get("content-length")||"0");let u=0;const h=c.createWriteStream(i),m=(o=a.body)==null?void 0:o.getReader();if(!m)throw new Error("No response body");for(;;){const{done:g,value:x}=await m.read();if(g)break;h.write(x),u+=x.length,s&&l>0&&s(Math.round(u/l*100))}return await new Promise((g,x)=>{h.end(S=>{S?x(S):g()})}),await Q.extract({file:i,cwd:r,strip:1}),c.rmSync(i,{force:!0}),r}catch(a){throw c.rmSync(i,{force:!0}),c.rmSync(r,{recursive:!0,force:!0}),a}}function Ae(e,n){const t=v(e,n);c.existsSync(t)&&c.rmSync(t,{recursive:!0,force:!0})}function Ie(e,n,t){const s=v(e,n),r=t==="32"?"x32":"x64",i=d.join(s,r);if(!c.existsSync(i))return[];try{return c.readdirSync(i).filter(o=>o.endsWith(".dll")).map(o=>d.join(i,o))}catch{return[]}}function B(e){const n=c.readFileSync(e);return M.createHash("sha256").update(n).digest("hex")}function A(e){return d.join(e,"dxvk_studio_manifest.json")}function b(e){const n=A(e);if(!c.existsSync(n))return null;try{const t=c.readFileSync(n,"utf-8");return JSON.parse(t)}catch{return null}}function K(e,n){const t=A(e);c.writeFileSync(t,JSON.stringify(n,null,2))}function z(e){return b(e)!==null}function X(e){const n=b(e);return n?{version:n.engineVersion,fork:n.engineFork}:null}function q(e){const n=b(e);if(!n)return"not_installed";for(const t of n.dlls){const s=d.join(e,t.name);if(!c.existsSync(s))return"missing";if(B(s)!==t.hash)return"corrupt"}return"ok"}function $e(e,n,t,s,r){if(r==="unknown")throw new Error("Cannot install DXVK: unknown architecture");const i=Ie(t,s,r);if(i.length===0)throw new Error(`No DLLs found for ${t} ${s} (${r}-bit)`);const o=[];for(const l of i){const u=d.basename(l),h=d.join(e,u),m=d.join(e,`${u}.bak_dxvk_studio`);if(c.existsSync(h)){const g=b(e);(g==null?void 0:g.dlls.some(S=>S.name===u))||c.renameSync(h,m)}c.copyFileSync(l,h),o.push({name:u,hash:B(h),backupPath:c.existsSync(m)?m:void 0})}const a={gameId:n,engineVersion:s,engineFork:t,architecture:r,installedAt:new Date().toISOString(),dlls:o};return K(e,a),a}function Pe(e){const n=b(e);if(!n)return!1;for(const s of n.dlls){const r=d.join(e,s.name),i=s.backupPath;c.existsSync(r)&&c.rmSync(r),i&&c.existsSync(i)&&c.renameSync(i,r)}const t=d.join(e,"dxvk.conf");return c.existsSync(t)&&n.configPath===t&&c.rmSync(t),c.rmSync(A(e)),!0}function Le(e){const n={},t=e.split(`
`);for(const s of t){const r=s.trim();if(!r||r.startsWith("#"))continue;const i=r.match(/^([^=]+)=(.*)$/);if(i){const o=i[1].trim(),a=i[2].trim();switch(o){case"dxvk.enableAsync":case"dxvk.gplAsyncCache":n.enableAsync=a==="true";break;case"dxgi.maxFrameRate":n.maxFrameRate=Number(a);break;case"dxgi.syncInterval":n.syncInterval=Number(a);break;case"dxgi.maxFrameLatency":n.maxFrameLatency=Number(a);break;case"dxvk.numCompilerThreads":n.numCompilerThreads=Number(a);break;case"dxvk.hud":case"DXVK_HUD":n.hud=a.split(",").map(l=>l.trim()).filter(l=>l.length>0);break;case"dxgi.customVendorId":n.customVendorId=a;break;case"dxgi.customDeviceId":n.customDeviceId=a;break;case"DXVK_LOG_LEVEL":n.logLevel=a;break}}}return n}function Ce(e){const n=d.join(e,"dxvk.conf");if(!c.existsSync(n))return null;try{const t=c.readFileSync(n,"utf-8");return Le(t)}catch{return null}}function Ve(e){const n=["# DXVK Configuration","# Generated by DXVK Studio",""];return e.enableAsync!==void 0&&n.push(`dxvk.enableAsync = ${e.enableAsync}`),e.numCompilerThreads!==void 0&&n.push(`dxvk.numCompilerThreads = ${e.numCompilerThreads}`),e.maxFrameLatency!==void 0&&n.push(`dxgi.maxFrameLatency = ${e.maxFrameLatency}`),e.syncInterval!==void 0&&n.push(`dxgi.syncInterval = ${e.syncInterval}`),e.maxFrameRate!==void 0&&n.push(`dxgi.maxFrameRate = ${e.maxFrameRate}`),e.maxDeviceMemory!==void 0&&n.push(`dxgi.maxDeviceMemory = ${e.maxDeviceMemory}`),e.customVendorId&&n.push(`dxgi.customVendorId = ${e.customVendorId}`),e.customDeviceId&&n.push(`dxgi.customDeviceId = ${e.customDeviceId}`),e.enableHDR!==void 0&&n.push(`dxgi.enableHDR = ${e.enableHDR}`),e.hud&&e.hud.length>0&&n.push(`DXVK_HUD = ${e.hud.join(",")}`),e.logLevel&&n.push(`DXVK_LOG_LEVEL = ${e.logLevel}`),n.join(`
`)}function Ge(e,n){const t=d.join(e,"dxvk.conf"),s=Ve(n);c.writeFileSync(t,s);const r=b(e);r&&(r.configPath=t,K(e,r))}function Z(e,n,t=3,s=0){if(s>t)return[];const r=[];try{const i=c.readdirSync(e,{withFileTypes:!0});for(const o of i){const a=d.join(e,o.name);if(o.isFile()){const l=o.name.toLowerCase();n.some(u=>l===u.toLowerCase())&&r.push(a)}else o.isDirectory()&&(["node_modules",".git","__pycache__","logs","saves"].includes(o.name.toLowerCase())||r.push(...Z(a,n,t,s+1)))}}catch{}return r}function J(e){if(!c.existsSync(e))return[];const n=[];for(const t of xe){const s=Z(e,t.files);s.length>0&&n.push({...t,foundFiles:s})}return n}function Me(e){const n=J(e);return{hasAntiCheat:n.length>0,highRisk:n.some(t=>t.riskLevel==="high"),detected:n.map(t=>t.name)}}process.env.DIST=d.join(__dirname,"../dist");process.env.VITE_PUBLIC=f.app.isPackaged?process.env.DIST:d.join(process.env.DIST,"../public");let y=null;const L=process.env.VITE_DEV_SERVER_URL;function C(){y=new f.BrowserWindow({width:1400,height:900,minWidth:1024,minHeight:700,icon:d.join(process.env.VITE_PUBLIC,"icon.png"),backgroundColor:"#0a0a0b",show:!1,webPreferences:{preload:d.join(__dirname,"preload.js"),nodeIntegration:!1,contextIsolation:!0,sandbox:!1}}),y.once("ready-to-show",()=>{y==null||y.show()}),L?(y.loadURL(L),y.webContents.openDevTools()):y.loadFile(d.join(process.env.DIST,"index.html")),y.webContents.setWindowOpenHandler(({url:e})=>((e.startsWith("https:")||e.startsWith("http:"))&&f.shell.openExternal(e),{action:"deny"}))}f.app.whenReady().then(()=>{C(),f.app.on("activate",()=>{f.BrowserWindow.getAllWindows().length===0&&C()})});f.app.on("window-all-closed",()=>{process.platform!=="darwin"&&(f.app.quit(),y=null)});f.ipcMain.handle("dialog:openFile",async()=>{const e=await f.dialog.showOpenDialog(y,{title:"Select Game Executable",filters:[{name:"Executables",extensions:["exe"]}],properties:["openFile"]});return e.canceled?null:e.filePaths[0]});f.ipcMain.handle("dialog:openFolder",async()=>{const e=await f.dialog.showOpenDialog(y,{title:"Select Game Folder",properties:["openDirectory"]});return e.canceled?null:e.filePaths[0]});f.ipcMain.handle("fs:exists",async(e,n)=>c.existsSync(n));f.ipcMain.handle("shell:openPath",async(e,n)=>f.shell.openPath(n));f.ipcMain.handle("games:scanAll",async()=>{try{const e=ae(),n=await ue(),t=me(),s=(a,l)=>{const u=l?d.join(a,l):"";let h="unknown";u&&c.existsSync(u)&&(h=T(u).architecture);let m="inactive",g,x;if(z(a)){const S=X(a),I=q(a);S&&(g=S.version,x=S.fork),m=I==="ok"?"active":I}return{architecture:h,dxvkStatus:m,dxvkVersion:g,dxvkFork:x}},r=await Promise.all(e.map(async a=>{const u=N(a.fullPath)[0]||"",h=s(a.fullPath,u);return{id:`steam-${a.appId}`,name:a.name,path:a.fullPath,executable:u,architecture:h.architecture,platform:"steam",steamAppId:a.appId,dxvkStatus:h.dxvkStatus,dxvkVersion:h.dxvkVersion,dxvkFork:h.dxvkFork,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}})),i=await Promise.all(n.map(async a=>{const l=a.executable?d.basename(a.executable):"",u=s(a.path,l);return{...a,executable:l,architecture:u.architecture,dxvkStatus:u.dxvkStatus,dxvkVersion:u.dxvkVersion,dxvkFork:u.dxvkFork}})),o=await Promise.all(t.map(async a=>{const l=a.executable?d.basename(a.executable):"",u=s(a.path,l);return{...a,executable:l,architecture:u.architecture,dxvkStatus:u.dxvkStatus,dxvkVersion:u.dxvkVersion,dxvkFork:u.dxvkFork}}));return[...r,...i,...o]}catch(e){return console.error("Failed to scan games:",e),[]}});f.ipcMain.handle("games:searchMetadata",async(e,n)=>oe(n));f.ipcMain.handle("games:searchMetadataMultiple",async(e,n)=>ce(n));f.ipcMain.handle("games:checkSteam",async()=>O()!==null);f.ipcMain.handle("pe:analyze",async(e,n)=>T(n));f.ipcMain.handle("pe:findExecutables",async(e,n)=>N(n));f.ipcMain.handle("pe:getVersionInfo",async(e,n)=>ve(n));f.ipcMain.handle("engines:getAvailable",async(e,n)=>_e(n));f.ipcMain.handle("engines:getCached",async(e,n)=>W(n));f.ipcMain.handle("engines:isCached",async(e,n,t)=>F(n,t));f.ipcMain.handle("engines:download",async(e,n,t,s)=>{try{return{success:!0,path:await Fe(n,t,s,i=>{y==null||y.webContents.send("engines:downloadProgress",{fork:n,version:t,percent:i})})}}catch(r){return{success:!1,error:r.message}}});f.ipcMain.handle("engines:getAllCached",async()=>be());f.ipcMain.handle("engines:delete",async(e,n,t)=>{try{return Ae(n,t),{success:!0}}catch(s){return{success:!1,error:s.message}}});f.ipcMain.handle("dxvk:install",async(e,n,t,s,r,i)=>{try{return{success:!0,manifest:$e(n,t,s,r,i)}}catch(o){return{success:!1,error:o.message}}});f.ipcMain.handle("dxvk:uninstall",async(e,n)=>{try{return{success:Pe(n)}}catch(t){return{success:!1,error:t.message}}});f.ipcMain.handle("dxvk:checkStatus",async(e,n)=>{if(!z(n))return{installed:!1};const s=X(n),r=q(n);return{installed:!0,version:s==null?void 0:s.version,fork:s==null?void 0:s.fork,integrity:r}});f.ipcMain.handle("config:save",async(e,n,t)=>{try{return Ge(n,t),{success:!0}}catch(s){return{success:!1,error:s.message}}});f.ipcMain.handle("config:read",async(e,n)=>Ce(n));f.ipcMain.handle("anticheat:detect",async(e,n)=>J(n));f.ipcMain.handle("anticheat:summary",async(e,n)=>Me(n));
